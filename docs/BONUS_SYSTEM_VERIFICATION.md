# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–æ–Ω—É—Å–æ–≤ –∏ 24-—á–∞—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –ª–æ–≥–∏–∫–∏ –±–æ–Ω—É—Å–Ω—ã—Ö —Å–µ—Ç–æ–∫, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –Ω–∞ 24 —á–∞—Å–∞.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏

**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

- –ü–æ–ª–µ `createdAt` –≤ —Ç–∞–±–ª–∏—Ü–µ `processor_deposits` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `@default(now())`
- –í—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ UTC —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ö–∞–∂–¥—ã–π –¥–µ–ø–æ–∑–∏—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ—á–Ω—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É —Å–æ–∑–¥–∞–Ω–∏—è

### 2. –õ–æ–≥–∏–∫–∞ 24-—á–∞—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞

**–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ö–û–†–†–ï–ö–¢–ù–û**

- –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UTC –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–∏–æ–¥–æ–≤
- –°–±—Ä–æ—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ **00:00:00 UTC** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å (UTC) —Å–∏—Å—Ç–µ–º–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
```
–í—á–µ—Ä–∞ (30 –∞–≤–≥—É—Å—Ç–∞ UTC): $800 –¥–µ–ø–æ–∑–∏—Ç–æ–≤ ‚Üí 5% –±–æ–Ω—É—Å
–°–µ–≥–æ–¥–Ω—è (31 –∞–≤–≥—É—Å—Ç–∞ UTC): $1200 –¥–µ–ø–æ–∑–∏—Ç–æ–≤ ‚Üí 7.5% –±–æ–Ω—É—Å  
–ó–∞–≤—Ç—Ä–∞ (1 —Å–µ–Ω—Ç—è–±—Ä—è UTC): $0 –¥–µ–ø–æ–∑–∏—Ç–æ–≤ ‚Üí 5% –±–æ–Ω—É—Å (–±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞)
```

### 3. –ë–æ–Ω—É—Å–Ω–∞—è —Å–µ—Ç–∫–∞

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ù–ê–°–¢–†–û–ï–ù–ê –ö–û–†–†–ï–ö–¢–ù–û**

| –î–∏–∞–ø–∞–∑–æ–Ω | –ë–æ–Ω—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| $0 - $1000 | 5% | –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ |
| $1000 - $5000 | 7.5% | –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ |
| $5000+ | 10% | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ |

### 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ù–ê–°–¢–†–û–ï–ù–´**

- **–ë–æ–Ω—É—Å –∑–∞ 100 –¥–µ–ø–æ–∑–∏—Ç–æ–≤**: +2% –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 100 –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- **–ë–æ–Ω—É—Å –∑–∞ –≤—ã—Å–æ–∫–∏–π –æ–±—ä–µ–º**: +$50 –ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º –æ–±—ä–µ–º–µ $10,000+
- **–ë–æ–Ω—É—Å –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: +1% –ø—Ä–∏ 7 –¥–Ω—è—Ö —Ä–∞–±–æ—Ç—ã –ø–æ–¥—Ä—è–¥

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –£—Ç–∏–ª–∏—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ (`src/lib/time-utils.ts`)

–°–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å UTC –≤—Ä–µ–º–µ–Ω–µ–º:

- `getCurrentUTCTime()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ UTC –≤—Ä–µ–º–µ–Ω–∏
- `getCurrentDayStartUTC()` - –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –ø–æ UTC
- `validate24HourReset()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Å–±—Ä–æ—Å–∞
- `getDayPeriod()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∞—Ç—ã

### API –¥–µ–ø–æ–∑–∏—Ç–æ–≤ (`src/app/api/processor/deposits/route.ts`)

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –±–æ–Ω—É—Å–æ–≤:

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ 24-—á–∞—Å–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
const utcNow = getCurrentUTCTime();
const todayStart = getCurrentDayStartUTC();

// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å (UTC)
const todayDeposits = await prisma.processor_deposits.findMany({
  where: {
    processorId,
    createdAt: { gte: todayStart }
  }
});

// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å
const existingTodaySum = todayDeposits.reduce((sum, d) => sum + d.amount, 0);
const todaySum = existingTodaySum + data.amount;
```

### API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (`src/app/api/processor/stats/route.ts`)

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º UTC –≤—Ä–µ–º—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ 24-—á–∞—Å–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
const utcNow = getCurrentUTCTime();
const todayStart = getCurrentDayStartUTC();
const weekStart = new Date(todayStart.getTime() - 7 * 24 * 60 * 60 * 1000);
const monthStart = new Date(utcNow.getUTCFullYear(), utcNow.getUTCMonth(), 1);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ 24-—á–∞—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞

```bash
node scripts/test-24hour-reset.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–±—Ä–æ—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ 00:00:00 UTC
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ë–æ–Ω—É—Å–Ω–∞—è —Å–µ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –¢–µ—Å—Ç 2: –°—Ü–µ–Ω–∞—Ä–∏–π –±–æ–Ω—É—Å–æ–≤

```bash
node scripts/test-bonus-scenario.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–µ–≥–æ–¥–Ω—è $800 = 5% –±–æ–Ω—É—Å ($40)
- ‚úÖ –ó–∞–≤—Ç—Ä–∞ $1200 = 7.5% –±–æ–Ω—É—Å ($90)
- ‚úÖ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã–ª $800 —Å–µ–≥–æ–¥–Ω—è

```
–°—É–º–º–∞: $800
–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–µ—Ç–∫–∞: $0 - $1000 = 5%
–ë–æ–Ω—É—Å: $800 √ó 5% = $40
–ò—Ç–æ–≥–æ: $840
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã–ª $1200 –∑–∞–≤—Ç—Ä–∞

```
–°—É–º–º–∞: $1200
–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–µ—Ç–∫–∞: $1000 - $5000 = 7.5%
–ë–æ–Ω—É—Å: $1200 √ó 7.5% = $90
–ò—Ç–æ–≥–æ: $1290
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã–ª $5000 –≤ –æ–¥–∏–Ω –¥–µ–Ω—å

```
–°—É–º–º–∞: $5000
–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–µ—Ç–∫–∞: $5000+ = 10%
–ë–æ–Ω—É—Å: $5000 √ó 10% = $500
–ò—Ç–æ–≥–æ: $5500
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ø–æ UTC –≤—Ä–µ–º–µ–Ω–∏
2. **–¢–æ—á–Ω–æ—Å—Ç—å**: 24-—á–∞—Å–æ–≤–æ–π —Å–±—Ä–æ—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ—á–Ω–æ –≤ 00:00:00 UTC
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ª—é–±—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω–∞—Ö
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
5. **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –±–æ–Ω—É—Å–Ω—ã–µ —Å–µ—Ç–∫–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

–°–∏—Å—Ç–µ–º–∞ –≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

```
üí∞ –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞ $800:
   - –í—Ä–µ–º—è UTC: 2025-08-31T18:48:46.385Z
   - –ù–∞—á–∞–ª–æ –¥–Ω—è UTC: 2025-08-31T00:00:00.000Z
   - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∑–∞ –¥–µ–Ω—å: $0
   - –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞ –¥–µ–Ω—å: $800
   - 24-—á–∞—Å–æ–≤–æ–π —Å–±—Ä–æ—Å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: 5%
```

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –±–æ–Ω—É—Å–æ–≤ –∏ 24-—á–∞—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –∏ **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π 24-—á–∞—Å–æ–≤–æ–π —Å–±—Ä–æ—Å –ø–æ UTC
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ –ø–æ —Å–µ—Ç–∫–µ
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–µ–ø–æ–∑–∏—Ç–æ–≤.
